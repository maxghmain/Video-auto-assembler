<Window x:Class="AI_Video_Assembler.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AI_Video_Assembler"
        mc:Ignorable="d"
        Title="AI Video Auto-Assembler Pro" Height="768" Width="1366"
        WindowStartupLocation="CenterScreen" Background="#F3F4F6"
        Closing="Window_Closing">

    <Window.Resources>
        <!-- CONVERTERS -->
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- COLORS -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#4F46E5"/>
        <SolidColorBrush x:Key="PrimaryHover" Color="#4338CA"/>
        <SolidColorBrush x:Key="SecondaryBg" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextDark" Color="#1F2937"/>
        <SolidColorBrush x:Key="TextGray" Color="#6B7280"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E5E7EB"/>

        <!-- ICONS (Path Geometries) -->
        <Geometry x:Key="IconPlay">M8 5v14l11-7z</Geometry>
        <Geometry x:Key="IconPause">M6 19h4V5H6v14zm8-14v14h4V5h-4z</Geometry>
        <Geometry x:Key="IconStop">M6 6h12v12H6z</Geometry>
        <Geometry x:Key="IconFolder">M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z</Geometry>
        <Geometry x:Key="IconDelete">M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z</Geometry>
        <Geometry x:Key="IconEdit">M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z</Geometry>
        <Geometry x:Key="IconUp">M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z</Geometry>
        <Geometry x:Key="IconDown">M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z</Geometry>

        <!-- STYLES -->
        <Style TargetType="Button" x:Key="SidebarBtn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextGray}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Margin="0,2">
                            <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center" Margin="15,12"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F9FAFB"/>
                    <Setter Property="Foreground" Value="{StaticResource PrimaryColor}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="Button" x:Key="PrimaryBtn">
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Effect="{DynamicResource {x:Static DropShadowEffect.ShadowDepthProperty}}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryHover}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="IconBtn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F3F4F6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="PlayerBtn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#E5E7EB"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="50" Padding="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#33FFFFFF"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#E5E7EB"/>
            <Setter Property="VerticalGridLinesBrush" Value="#E5E7EB"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#F9FAFB"/>
            <Setter Property="Foreground" Value="#6B7280"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{TemplateBinding Background}" BorderThickness="0,0,0,1" BorderBrush="#E5E7EB">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Left" Margin="10,12"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Padding="10,8" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#EEF2FF"/>
                    <Setter Property="Foreground" Value="{StaticResource PrimaryColor}"/>
                    <Setter Property="BorderThickness" Value="0"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- SIDEBAR -->
        <Border Background="White" BorderBrush="#E5E7EB" BorderThickness="0,0,1,0">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="50"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Logo -->
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <Border Background="{StaticResource PrimaryColor}" Width="32" Height="32" CornerRadius="8" Margin="0,0,10,0">
                            <Path Data="{StaticResource IconPlay}" Fill="White" Stretch="Uniform" Margin="8" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="AI Video" FontSize="22" FontWeight="Bold" Foreground="{StaticResource TextDark}" VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock Text="Auto-Assembler Pro" FontSize="14" Foreground="{StaticResource TextGray}" Margin="42,-5,0,0"/>
                </StackPanel>

                <!-- Menu -->
                <StackPanel Grid.Row="2" Margin="0,20,0,0">
                    <TextBlock Text="WORKFLOW" FontSize="11" FontWeight="Bold" Foreground="#9CA3AF" Margin="10,0,0,10"/>
                    <Button x:Name="BtnStep1" Click="NavButton_Click" Tag="1" Style="{StaticResource SidebarBtn}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="1" FontWeight="Bold" Width="20" Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                            <TextBlock Text="Import &amp; Scene" />
                        </StackPanel>
                    </Button>
                    <Button x:Name="BtnStep2" Click="NavButton_Click" Tag="2" Style="{StaticResource SidebarBtn}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="2" FontWeight="Bold" Width="20" Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                            <TextBlock Text="Settings &amp; Trim" />
                        </StackPanel>
                    </Button>
                    <Button x:Name="BtnStep3" Click="NavButton_Click" Tag="3" Style="{StaticResource SidebarBtn}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="3" FontWeight="Bold" Width="20" Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                            <TextBlock Text="Visuals &amp; Text" />
                        </StackPanel>
                    </Button>
                    <Button x:Name="BtnStep4" Click="NavButton_Click" Tag="4" Style="{StaticResource SidebarBtn}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="4" FontWeight="Bold" Width="20" Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                            <TextBlock Text="Matrix Calc" />
                        </StackPanel>
                    </Button>
                    <Button x:Name="BtnStep5" Click="NavButton_Click" Tag="5" Style="{StaticResource SidebarBtn}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="5" FontWeight="Bold" Width="20" Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                            <TextBlock Text="Export" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Status -->
                <StackPanel Grid.Row="3">
                    <Grid Margin="0,0,0,5">
                        <TextBlock Text="Project Status" FontSize="12" Foreground="{StaticResource TextGray}"/>
                        <TextBlock x:Name="TxtProgress" Text="20%" FontSize="12" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" HorizontalAlignment="Right"/>
                    </Grid>
                    <ProgressBar x:Name="ProjectProgress" Height="8" Value="20" Maximum="100" BorderThickness="0" Background="#F3F4F6" Foreground="{StaticResource PrimaryColor}">
                        <ProgressBar.Clip>
                            <RectangleGeometry Rect="0,0,220,8" RadiusX="4" RadiusY="4"/>
                        </ProgressBar.Clip>
                    </ProgressBar>
                    <TextBlock Text="v1.0.2 Pro" FontSize="10" Foreground="#D1D5DB" HorizontalAlignment="Center" Margin="0,20,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- MAIN CONTENT -->
        <Grid Grid.Column="1" Margin="30">

            <!-- STEP 1: IMPORT -->
            <Grid x:Name="ViewStep1" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel>
                    <TextBlock Text="จัดการซีนวิดีโอ (Scene Management)" FontSize="26" FontWeight="Bold" Foreground="{StaticResource TextDark}"/>
                    <TextBlock Text="นำเข้าโฟลเดอร์วิดีโอและจัดลำดับซีนเพื่อเตรียมประกอบร่าง" FontSize="14" Foreground="{StaticResource TextGray}" Margin="0,5,0,25"/>
                </StackPanel>
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Border Background="White" CornerRadius="12" Effect="{DynamicResource {x:Static DropShadowEffect.ShadowDepthProperty}}">
                        <Grid Margin="15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Button Style="{StaticResource PrimaryBtn}" Click="AddFolder_Click" Margin="0,0,0,15" Height="45">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="{StaticResource IconFolder}" Fill="White" Height="18" Stretch="Uniform" Margin="0,0,12,0"/>
                                    <TextBlock Text="นำเข้าโฟลเดอร์ซีน" FontSize="15" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <ListBox x:Name="ListFolders" Grid.Row="1" BorderThickness="0" Background="Transparent" SelectionChanged="ListFolders_SelectionChanged" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="8" Padding="10" Margin="0,0,0,8" BorderThickness="1" BorderBrush="Transparent" Cursor="Hand">
                                                        <ContentPresenter/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="#EEF2FF"/>
                                                            <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource PrimaryColor}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="#F9FAFB"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Background="#E0E7FF" Width="36" Height="36" CornerRadius="8" Margin="0,0,12,0">
                                                <TextBlock Text="{Binding FileCount}" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="{StaticResource TextDark}" TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Text="{Binding FolderPath}" FontSize="10" Foreground="{StaticResource TextGray}" TextTrimming="CharacterEllipsis" Opacity="0.7"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                <Button Style="{StaticResource IconBtn}" Tag="{Binding}" Click="MoveSceneUp_Click" ToolTip="เลื่อนขึ้น" Margin="0,0,4,0">
                                                    <Path Data="{StaticResource IconUp}" Fill="#9CA3AF" Height="14" Stretch="Uniform"/>
                                                </Button>
                                                <Button Style="{StaticResource IconBtn}" Tag="{Binding}" Click="MoveSceneDown_Click" ToolTip="เลื่อนลง" Margin="0,0,4,0">
                                                    <Path Data="{StaticResource IconDown}" Fill="#9CA3AF" Height="14" Stretch="Uniform"/>
                                                </Button>
                                                <Button Style="{StaticResource IconBtn}" Tag="{Binding}" Click="EditSceneName_Click" ToolTip="แก้ไขชื่อ" Margin="0,0,4,0">
                                                    <Path Data="{StaticResource IconEdit}" Fill="#6B7280" Height="14" Stretch="Uniform"/>
                                                </Button>
                                                <Button Style="{StaticResource IconBtn}" Tag="{Binding}" Click="DeleteFolder_Click" ToolTip="ลบ">
                                                    <Path Data="{StaticResource IconDelete}" Fill="#EF4444" Height="14" Stretch="Uniform"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </Border>
                    <Border Grid.Column="2" Background="White" CornerRadius="12" Padding="20">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="รายการไฟล์ในซีน (Files)" FontWeight="Bold" Margin="0,0,0,15" Foreground="{StaticResource TextGray}"/>
                            <DataGrid x:Name="GridFiles" Grid.Row="1">
                                <DataGrid.Columns>
                                    <!-- Added UpdateSourceTrigger=PropertyChanged for instant validation -->
                                    <DataGridCheckBoxColumn Header="" Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Width="40" ElementStyle="{StaticResource {x:Type CheckBox}}"/>
                                    <DataGridTextColumn Header="ชื่อไฟล์ (Filename)" Binding="{Binding Name}" Width="*" IsReadOnly="True"/>
                                    <DataGridTextColumn Header="ความยาว" Binding="{Binding Duration}" Width="100" IsReadOnly="True"/>
                                    <DataGridTemplateColumn Header="สถานะ" Width="120">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding StatusColor}" CornerRadius="4" Padding="8,2" HorizontalAlignment="Left">
                                                    <TextBlock Text="{Binding Status}" Foreground="White" FontSize="11" FontWeight="Bold"/>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>
                </Grid>
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,30,0,0">
                    <Button Content="ถัดไป (Step 2) >" Width="220" Height="50" FontSize="16" Style="{StaticResource PrimaryBtn}" Click="NextStep_Click"/>
                </StackPanel>
            </Grid>

            <!-- STEP 2: SETTINGS & TRIM -->
            <Grid x:Name="ViewStep2" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel>
                    <TextBlock Text="ตั้งค่าการตัดต่อ (Trimming &amp; Speed)" FontSize="26" FontWeight="Bold" Foreground="{StaticResource TextDark}"/>
                    <TextBlock Text="กำหนดช่วงเวลาตัดหัว-ท้าย และปรับความเร็วของวิดีโอ" FontSize="14" Foreground="{StaticResource TextGray}" Margin="0,5,0,25"/>
                </StackPanel>
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2.5*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>
                    <Border Background="Black" CornerRadius="12" ClipToBounds="True">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Viewbox Grid.Row="0" Stretch="Uniform" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <Grid x:Name="PreviewScreen" Width="1280" Height="720" Background="Black">
                                    <TextBlock x:Name="PreviewPlaceholder" Text="PREVIEW AREA" Foreground="#374151" FontSize="48" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.5"/>
                                    <MediaElement x:Name="PreviewPlayerA" LoadedBehavior="Manual" UnloadedBehavior="Manual" Stretch="Uniform"/>
                                    <MediaElement x:Name="PreviewPlayerB" LoadedBehavior="Manual" UnloadedBehavior="Manual" Stretch="Uniform" Opacity="0"/>
                                </Grid>
                            </Viewbox>

                            <Border Grid.Row="1" Padding="15,10">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="#00000000" Offset="0"/>
                                        <GradientStop Color="#CC000000" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <StackPanel>
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="TxtCurrentTime" Text="00:00" Foreground="#D1D5DB" FontSize="12" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <Slider x:Name="TimelineSlider" Grid.Column="1" VerticalAlignment="Center" 
                                                PreviewMouseDown="TimelineSlider_PreviewMouseDown" 
                                                PreviewMouseUp="TimelineSlider_PreviewMouseUp"
                                                IsMoveToPointEnabled="True"
                                                Background="#40FFFFFF" Foreground="#FF0000">
                                            <Slider.Resources>
                                                <Style TargetType="Thumb">
                                                    <Setter Property="Background" Value="#FF0000"/>
                                                    <Setter Property="Width" Value="12"/>
                                                    <Setter Property="Height" Value="12"/>
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Thumb">
                                                                <Ellipse Fill="{TemplateBinding Background}" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}"/>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </Slider.Resources>
                                        </Slider>
                                        <TextBlock x:Name="TxtTotalTime" Grid.Column="2" Text="00:00" Foreground="#D1D5DB" FontSize="12" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                    </Grid>
                                    <Grid>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button x:Name="BtnStopPreview" Click="StopPreview_Click" Width="40" Height="40" Style="{StaticResource PlayerBtn}" ToolTip="Stop / Reset">
                                                <Path Data="{StaticResource IconStop}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Height="14" Stretch="Uniform"/>
                                            </Button>
                                            <Button x:Name="BtnPlayPreview" Click="PlaySequencePreview_Click" Width="50" Height="50" Margin="15,0" Style="{StaticResource PlayerBtn}" ToolTip="Play">
                                                <Path Data="{StaticResource IconPlay}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Height="22" Stretch="Uniform" Margin="3,0,0,0"/>
                                            </Button>
                                            <Button x:Name="BtnPausePreview" Click="PausePreview_Click" Width="40" Height="40" Style="{StaticResource PlayerBtn}" ToolTip="Pause">
                                                <Path Data="{StaticResource IconPause}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Height="16" Stretch="Uniform"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>
                    <Border Grid.Column="2" Background="White" CornerRadius="12" Padding="25">
                        <StackPanel>
                            <TextBlock Text="Global Configuration" FontWeight="Bold" FontSize="16" Margin="0,0,0,20" Foreground="{StaticResource TextDark}"/>
                            <TextBlock Text="ตัดหัวคลิป (Start Trim)" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource TextGray}"/>
                            <TextBox x:Name="TxtTrimStart" Text="0.0" Padding="10" BorderBrush="{StaticResource BorderColor}" Margin="0,0,0,15"/>
                            <TextBlock Text="ตัดท้ายคลิป (End Trim)" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource TextGray}"/>
                            <TextBox x:Name="TxtTrimEnd" Text="0.0" Padding="10" BorderBrush="{StaticResource BorderColor}" Margin="0,0,0,15"/>
                            <Separator Background="{StaticResource BorderColor}" Margin="0,10,0,20"/>
                            <TextBlock Text="ความเร็ว (Speed Ratio)" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource TextGray}"/>
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Slider x:Name="SpeedSlider" Minimum="0.5" Maximum="3.0" Value="1.0" TickFrequency="0.1" IsSnapToTickEnabled="True" ValueChanged="SpeedSlider_ValueChanged"/>
                                <TextBlock x:Name="TxtSpeedValue" Grid.Column="1" Text="1.0x" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" Margin="10,0,0,0"/>
                            </Grid>
                            <CheckBox x:Name="ChkMuteAudio" Content="ปิดเสียงต้นฉบับ (Mute Original Audio)" Margin="0,0,0,20" Click="MuteAudio_Click"/>
                            <Separator Background="{StaticResource BorderColor}" Margin="0,0,0,20"/>
                            <TextBlock Text="อัตราส่วน (Aspect Ratio)" FontWeight="SemiBold" Margin="0,0,0,10" Foreground="{StaticResource TextGray}"/>
                            <StackPanel Orientation="Horizontal">
                                <RadioButton Content="16:9 Landscape" GroupName="Ratio" IsChecked="True" Tag="16:9" Margin="0,0,20,0" Click="AspectRatio_Click"/>
                                <RadioButton Content="9:16 Portrait" GroupName="Ratio" Tag="9:16" Click="AspectRatio_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,30,0,0">
                    <Button Content="ย้อนกลับ" Width="150" Height="50" FontSize="16" Background="Transparent" Foreground="{StaticResource TextGray}" Margin="0,0,15,0" Click="PrevStep_Click"/>
                    <Button Content="ถัดไป (Step 3) >" Width="220" Height="50" FontSize="16" Style="{StaticResource PrimaryBtn}" Click="NextStep_Click"/>
                </StackPanel>
            </Grid>

            <!-- STEP 3: VISUALS & TEXT -->
            <Grid x:Name="ViewStep3" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel>
                    <TextBlock Text="ตกแต่งข้อความ (Visuals &amp; Animation)" FontSize="26" FontWeight="Bold" Foreground="{StaticResource TextDark}"/>
                    <TextBlock Text="เพิ่มข้อความ ปรับแต่งตำแหน่ง สี และใส่ Effect การเคลื่อนไหว" FontSize="14" Foreground="{StaticResource TextGray}" Margin="0,5,0,25"/>
                </StackPanel>

                <!-- Content -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <!-- Left: Video Player Module (2.5*) -->
                        <ColumnDefinition Width="2.5*"/>
                        <ColumnDefinition Width="20"/>
                        <!-- Right: Tools (1*) -->
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <!-- LEFT: Video Player Module -->
                    <Border Background="Black" CornerRadius="12" ClipToBounds="True">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Viewbox Grid.Row="0" Stretch="Uniform" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <Grid x:Name="PreviewScreenStep3" Width="1280" Height="720" Background="Black">

                                    <!-- Preview Area Text for Step 3 -->
                                    <TextBlock x:Name="PreviewPlaceholderStep3" Text="PREVIEW AREA" Foreground="#374151" FontSize="48" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.5"/>

                                    <MediaElement x:Name="PreviewPlayerStep3" LoadedBehavior="Manual" UnloadedBehavior="Manual" Stretch="Uniform"/>
                                    <!-- Overlay Text Layers -->
                                    <ItemsControl x:Name="OverlayItemsControl" ItemsSource="{Binding ElementName=ListTextLayers, Path=ItemsSource}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <Canvas Background="Transparent" ClipToBounds="True"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemContainerStyle>
                                            <Style TargetType="ContentPresenter">
                                                <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                                <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                                            </Style>
                                        </ItemsControl.ItemContainerStyle>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <!-- [Fixed] Bind BorderThickness to new Property & FontFamily -->
                                                <Border Background="{Binding DisplayBrush}" 
                                                        Padding="10,5" CornerRadius="4" 
                                                        BorderBrush="{Binding LayerBorderBrush}" 
                                                        BorderThickness="{Binding LayerBorderThickness}"
                                                        Cursor="SizeAll"
                                                        MouseDown="TextOverlay_MouseDown" 
                                                        MouseMove="TextOverlay_MouseMove" 
                                                        MouseUp="TextOverlay_MouseUp">
                                                    <TextBlock Text="{Binding Text}" 
                                                               FontFamily="{Binding FontFamily}"
                                                               FontSize="{Binding FontSize}" 
                                                               Foreground="White" 
                                                               FontWeight="Bold"
                                                               TextAlignment="{Binding TextAlign}"
                                                               IsHitTestVisible="False"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Grid>
                            </Viewbox>

                            <!-- Player Controls -->
                            <Border Grid.Row="1" Padding="15,10">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="#00000000" Offset="0"/>
                                        <GradientStop Color="#CC000000" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <StackPanel>
                                    <!-- Timeline [UPDATED LAYOUT] -->
                                    <Grid Margin="10,0,10,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Current Time (Left) -->
                                        <TextBlock x:Name="TxtCurrentTimeStep3" Text="00:00" Foreground="#D1D5DB" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Left"/>

                                        <!-- Slider (Shorter with Margin) -->
                                        <Slider x:Name="TimelineSliderStep3" Grid.Column="1" VerticalAlignment="Center" 
                                                PreviewMouseDown="TimelineSliderStep3_PreviewMouseDown" 
                                                PreviewMouseUp="TimelineSliderStep3_PreviewMouseUp"
                                                IsMoveToPointEnabled="True"
                                                Margin="30,0"
                                                Background="#40FFFFFF" Foreground="#FF0000">
                                            <Slider.Resources>
                                                <Style TargetType="Thumb">
                                                    <Setter Property="Background" Value="#FF0000"/>
                                                    <Setter Property="Width" Value="12"/>
                                                    <Setter Property="Height" Value="12"/>
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Thumb">
                                                                <Ellipse Fill="{TemplateBinding Background}" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}"/>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </Slider.Resources>
                                        </Slider>

                                        <!-- Total Time (Right) -->
                                        <TextBlock x:Name="TxtTotalTimeStep3" Grid.Column="2" Text="00:00" Foreground="#D1D5DB" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                    </Grid>

                                    <!-- Controls Center -->
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">

                                        <!-- Stop Button -->
                                        <Button x:Name="BtnStopStep3" Click="StopPreviewStep3_Click" Width="40" Height="40" Style="{StaticResource PlayerBtn}" ToolTip="Stop / Reset">
                                            <Path Data="{StaticResource IconStop}" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Height="14" Stretch="Uniform"/>
                                        </Button>

                                        <!-- Play Button -->
                                        <Button x:Name="BtnPlayStep3" Click="PreviewStep3_Play" Width="50" Height="50" Margin="15,0" Style="{StaticResource PlayerBtn}" ToolTip="Play Animation">
                                            <Path Data="{StaticResource IconPlay}" Fill="White" Height="22" Stretch="Uniform" Margin="3,0,0,0"/>
                                        </Button>

                                        <Button x:Name="BtnPauseStep3" Click="PreviewStep3_Pause" Width="40" Height="40" Style="{StaticResource PlayerBtn}" ToolTip="Pause">
                                            <Path Data="{StaticResource IconPause}" Fill="White" Height="16" Stretch="Uniform"/>
                                        </Button>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- RIGHT: Tools & Properties -->
                    <Border Grid.Column="2" Background="White" CornerRadius="12" Padding="20">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Scene Select -->
                                <RowDefinition Height="Auto"/>
                                <!-- Toolbar -->
                                <RowDefinition Height="120"/>
                                <!-- Layer List -->
                                <RowDefinition Height="*"/>
                                <!-- Inspector -->
                            </Grid.RowDefinitions>

                            <!-- Scene Select -->
                            <StackPanel Grid.Row="0" Margin="0,0,0,15">
                                <TextBlock Text="เลือกซีน (Select Scene)" FontWeight="Bold" Foreground="{StaticResource TextGray}" Margin="0,0,0,5"/>
                                <ComboBox x:Name="SceneSelectVisual" SelectionChanged="SceneSelectVisual_SelectionChanged" Height="35" Padding="5" Background="#F9FAFB"/>
                            </StackPanel>

                            <!-- Layer Toolbar -->
                            <Grid Grid.Row="1" Margin="0,0,0,5">
                                <TextBlock Text="เลเยอร์ (Layers)" FontWeight="Bold" VerticalAlignment="Center" Foreground="{StaticResource TextGray}"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="+ เพิ่มข้อความ" Click="AddText_Click" FontSize="11" Padding="10,5" Background="#ECFDF5" Foreground="#059669" BorderThickness="0" Margin="0,0,5,0" Cursor="Hand">
                                        <Button.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="4"/>
                                            </Style>
                                        </Button.Resources>
                                    </Button>
                                    <Button Content="ลบ" Click="RemoveText_Click" FontSize="11" Padding="10,5" Background="#FEF2F2" Foreground="#DC2626" BorderThickness="0" Cursor="Hand">
                                        <Button.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="4"/>
                                            </Style>
                                        </Button.Resources>
                                    </Button>
                                </StackPanel>
                            </Grid>

                            <!-- Layer List -->
                            <ListBox x:Name="ListTextLayers" Grid.Row="2" BorderBrush="#E5E7EB" SelectionChanged="ListTextLayers_SelectionChanged" Margin="0,0,0,15">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Background="#E0E7FF" Width="24" Height="24" CornerRadius="4" Margin="0,0,10,0">
                                                <TextBlock Text="T" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Grid.Column="1" Text="{Binding Text}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <!-- Properties Inspector -->
                            <Border Grid.Row="3" Background="#F9FAFB" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="8">
                                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="15">
                                    <StackPanel DataContext="{Binding ElementName=ListTextLayers, Path=SelectedItem}">
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>

                                        <!-- Content [UPDATED] -->
                                        <TextBlock Text="ข้อความ (Content)" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource TextGray}"/>
                                        <!-- Changed Height to MinHeight and added AcceptsReturn + TextWrapping -->
                                        <TextBox Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}" 
                                                 MinHeight="60" MaxHeight="120"
                                                 AcceptsReturn="True" 
                                                 TextWrapping="Wrap" 
                                                 VerticalScrollBarVisibility="Auto"
                                                 Padding="5" BorderBrush="{StaticResource BorderColor}" Margin="0,0,0,15"/>

                                        <!-- Font Selection -->
                                        <TextBlock Text="แบบอักษร (Font Family &amp; Style)" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource TextGray}"/>

                                        <Grid Margin="0,0,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <ComboBox x:Name="CmbFontFamily" 
              ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontGroups}"
              DisplayMemberPath="FamilyName"
              SelectionChanged="CmbFontFamily_SelectionChanged"
              Height="35" VerticalContentAlignment="Center" Background="White" BorderBrush="{StaticResource BorderColor}"
              Padding="5,0"/>

                                            <ComboBox x:Name="CmbFontStyle" 
              Grid.Column="2"
              DisplayMemberPath="StyleName"
              SelectionChanged="CmbFontStyle_SelectionChanged"
              Height="35" VerticalContentAlignment="Center" Background="White" BorderBrush="{StaticResource BorderColor}"
              Padding="5,0"/>

                                            <Button Grid.Column="3" Content="Import" Click="ImportFontZip_Click" 
            Width="50" Margin="5,0,0,0" Height="35"
            Background="#EEF2FF" BorderBrush="{StaticResource PrimaryColor}" BorderThickness="1"
            Foreground="{StaticResource PrimaryColor}" Cursor="Hand" ToolTip="Import .zip"/>
                                        </Grid>

                                        <!-- Position Grid -->
                                        <TextBlock Text="จัดตำแหน่ง (Position)" FontSize="10" Foreground="#9CA3AF" Margin="0,0,0,5"/>
                                        <UniformGrid Rows="3" Columns="3" Margin="0,0,0,15" Width="100" HorizontalAlignment="Left">
                                            <Button Content="↖" Tag="TL" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="↑" Tag="TC" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="↗" Tag="TR" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="←" Tag="CL" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="•" Tag="CC" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="→" Tag="CR" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="↙" Tag="BL" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="↓" Tag="BC" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                            <Button Content="↘" Tag="BR" Click="SetTextPosition_Click" Height="25" Margin="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1"/>
                                        </UniformGrid>

                                        <!-- [UPDATED] Background Color Section -->
                                        <TextBlock Text="สีพื้นหลัง (Background Color)" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{StaticResource TextGray}"/>

                                        <!-- Mode Switcher -->
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                            <RadioButton Content="สีเดียว" GroupName="BgMode" Tag="Solid" IsChecked="{Binding BgMode, Converter={x:Null}, FallbackValue=True}" Click="RbMode_Click" Margin="0,0,10,0"/>
                                            <RadioButton Content="ไล่สี" GroupName="BgMode" Tag="Gradient" Click="RbMode_Click" Margin="0,0,10,0"/>
                                            <RadioButton Content="สุ่ม" GroupName="BgMode" Tag="Random" Click="RbMode_Click"/>
                                        </StackPanel>

                                        <!-- Mode 0: Solid Color -->
                                        <StackPanel x:Name="PanelSolidColor">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding BgMode}" Value="0">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                            <Grid Margin="0,0,0,5">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBox Text="{Binding BgColor, UpdateSourceTrigger=PropertyChanged}" Height="28" VerticalContentAlignment="Center" Padding="5,0"/>
                                                <Border Grid.Column="1" Background="{Binding BgColor}" Width="28" Height="28" Margin="5,0,0,0" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" CornerRadius="4"/>
                                            </Grid>
                                            <TextBlock Text="Presets:" FontSize="10" Foreground="#9CA3AF" Margin="0,0,0,2"/>
                                            <ListBox x:Name="ListCachedColors" Height="40" Margin="0,0,0,5" BorderBrush="{StaticResource BorderColor}">
                                                <ListBox.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel />
                                                    </ItemsPanelTemplate>
                                                </ListBox.ItemsPanel>
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <Button Background="{Binding}" Width="20" Height="20" Margin="2" Tag="{Binding}" Click="PresetColor_Click" ToolTip="{Binding}"/>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <Button Content="บันทึกสี" Click="AddColorToCache_Click" FontSize="10" Padding="5,2" Margin="0,0,5,0"/>
                                                <Button Content="ล้าง" Click="RemoveColorFromCache_Click" FontSize="10" Padding="5,2"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Mode 1: Gradient -->
                                        <StackPanel x:Name="PanelGradient">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding BgMode}" Value="1">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>

                                            <Grid Margin="0,0,0,5">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Margin="0,0,5,0">
                                                    <TextBlock Text="สีเริ่ม" FontSize="10" Foreground="#9CA3AF"/>
                                                    <TextBox Text="{Binding BgColor, UpdateSourceTrigger=PropertyChanged}" Height="28" VerticalContentAlignment="Center"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                                    <TextBlock Text="สีจบ" FontSize="10" Foreground="#9CA3AF"/>
                                                    <TextBox Text="{Binding GradientEndColor, UpdateSourceTrigger=PropertyChanged}" Height="28" VerticalContentAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>

                                            <!-- Presets for Gradient picking -->
                                            <TextBlock Text="เลือกสีเร็ว:" FontSize="10" Foreground="#9CA3AF"/>
                                            <WrapPanel Margin="0,2,0,5">
                                                <Button Background="#FF0000" Width="20" Height="20" Margin="1" Tag="#FF0000" Click="PresetColor_Click" ToolTip="Set Start Red"/>
                                                <Button Background="#00FF00" Width="20" Height="20" Margin="1" Tag="#00FF00" Click="PresetColor_Click" ToolTip="Set Start Green"/>
                                                <Button Background="#0000FF" Width="20" Height="20" Margin="1" Tag="#0000FF" Click="PresetColor_Click" ToolTip="Set Start Blue"/>
                                                <TextBlock Text="->" VerticalAlignment="Center" Margin="5,0"/>
                                                <Button Background="#FFFF00" Width="20" Height="20" Margin="1" Tag="#FFFF00" Click="PresetGradientEnd_Click" ToolTip="Set End Yellow"/>
                                                <Button Background="#00FFFF" Width="20" Height="20" Margin="1" Tag="#00FFFF" Click="PresetGradientEnd_Click" ToolTip="Set End Cyan"/>
                                                <Button Background="#FF00FF" Width="20" Height="20" Margin="1" Tag="#FF00FF" Click="PresetGradientEnd_Click" ToolTip="Set End Magenta"/>
                                            </WrapPanel>

                                            <CheckBox Content="แนวนอน (Horizontal)" IsChecked="{Binding IsGradientHorizontal}" Margin="0,5,0,0"/>
                                        </StackPanel>

                                        <!-- Mode 2: Random -->
                                        <StackPanel x:Name="PanelRandom">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding BgMode}" Value="2">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                            <TextBlock Text="รายการสีสุ่ม (Random Pool)" FontSize="11" Foreground="#6B7280" Margin="0,0,0,5"/>

                                            <!-- Pool List -->
                                            <ListBox ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=RandomColorPool}" Height="80" BorderBrush="{StaticResource BorderColor}" Margin="0,0,0,5">
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="20"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <Border Background="{Binding}" Width="16" Height="16" CornerRadius="2" BorderBrush="#DDD" BorderThickness="1"/>
                                                            <TextBlock Grid.Column="1" Text="{Binding}" Margin="10,0,0,0" VerticalAlignment="Center" FontSize="11"/>
                                                            <Button Grid.Column="2" Content="x" Click="RemoveColorFromRandomPool_Click" DataContext="{Binding}" Padding="5,0" Background="Transparent" Foreground="Red" BorderThickness="0"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>

                                            <Button Content="+ เพิ่มสีปัจจุบันลงรายการสุ่ม" Click="AddColorToRandomPool_Click" Height="25" FontSize="11" Background="#EEF2FF" Foreground="{StaticResource PrimaryColor}" BorderThickness="0"/>
                                            <TextBlock Text="* ระบบจะสุ่มสีจากรายการนี้เมื่อสร้างวิดีโอ" FontSize="10" Foreground="#9CA3AF" Margin="0,5,0,0" TextWrapping="Wrap"/>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" Margin="0,15,0,15">
                                            <TextBlock Text="Opacity:" FontSize="10" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                            <Slider Value="{Binding BgOpacity}" Minimum="0" Maximum="1" Width="100"/>
                                        </StackPanel>

                                        <Separator Background="{StaticResource BorderColor}" Margin="0,5,0,15"/>

                                        <!-- Animation -->
                                        <TextBlock Text="✨ Animation" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" Margin="0,0,0,10"/>
                                        <TextBlock Text="Effect:" FontSize="11" Foreground="{StaticResource TextGray}"/>
                                        <ComboBox SelectedValue="{Binding AnimationEffect}" ItemsSource="{Binding Source={x:Static local:MainWindow+TextLayer.EffectOptions}}" Height="30" Margin="0,2,0,10"/>

                                        <Grid Margin="0,0,0,5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Delay (เริ่ม):" FontSize="11" Foreground="{StaticResource TextGray}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding Delay, StringFormat={}{0:N1}s}" FontSize="11" FontWeight="Bold"/>
                                        </Grid>
                                        <Slider Value="{Binding Delay}" Minimum="0" Maximum="10" TickFrequency="0.5" IsSnapToTickEnabled="True" Margin="0,0,0,10"/>

                                        <Grid Margin="0,0,0,5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Duration (แสดงนาน):" FontSize="11" Foreground="{StaticResource TextGray}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding TextDuration, StringFormat={}{0:N1}s}" FontSize="11" FontWeight="Bold"/>
                                        </Grid>
                                        <Slider Value="{Binding TextDuration}" Minimum="1" Maximum="20" TickFrequency="0.5" IsSnapToTickEnabled="True" Margin="0,0,0,10"/>

                                        <CheckBox Content="เล่น Effect ขาออก (Reverse Out)" IsChecked="{Binding HasExitAnimation}" Margin="0,5,0,0" Foreground="{StaticResource TextDark}"/>
                                    </StackPanel>
                                </ScrollViewer>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,30,0,0">
                    <Button Content="ย้อนกลับ" Width="150" Height="50" FontSize="16" Background="Transparent" Foreground="{StaticResource TextGray}" Margin="0,0,10,0" Click="PrevStep_Click"/>
                    <Button Content="ถัดไป (Step 4) >" Width="220" Height="50" FontSize="16" Style="{StaticResource PrimaryBtn}" Click="NextStep_Click"/>
                </StackPanel>
            </Grid>

            <!-- STEP 4: MATRIX -->
            <Grid x:Name="ViewStep4" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="0,0,0,20">
                    <TextBlock Text="Matrix Calculation (คำนวณรูปแบบวิดีโอ)" FontSize="26" FontWeight="Bold" Foreground="{StaticResource TextDark}"/>
                    <TextBlock Text="คำนวณความเป็นไปได้ทั้งหมด และตรวจสอบตัวอย่างผลลัพธ์" FontSize="14" Foreground="{StaticResource TextGray}" Margin="0,5,0,0"/>
                </StackPanel>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Background="White" CornerRadius="12" Effect="{DynamicResource {x:Static DropShadowEffect.ShadowDepthProperty}}">
                        <StackPanel Margin="20">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="#EEF2FF" Width="40" Height="40" CornerRadius="8">
                                    <TextBlock Text="∑" FontSize="20" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Calculation" FontSize="18" FontWeight="Bold" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="{StaticResource TextDark}"/>
                            </StackPanel>

                            <Button x:Name="BtnCalcMatrix" Click="CalcMatrix_Click" Content="🔄 เริ่มคำนวณ (Calculate)" Height="50" Style="{StaticResource PrimaryBtn}" Margin="0,0,0,20" FontSize="14"/>

                            <Border Background="#F9FAFB" CornerRadius="8" Padding="15" Margin="0,0,0,20" BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
                                <StackPanel>
                                    <TextBlock Text="รูปแบบทั้งหมด (Total Combinations)" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <TextBlock x:Name="TxtTotalCombinations" Text="-" FontSize="28" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" Margin="0,5,0,0"/>
                                    <TextBlock x:Name="TxtSceneCountInfo" Text="จาก 0 ซีน x 0 ไฟล์" FontSize="11" Foreground="{StaticResource TextGray}" Margin="0,2,0,0"/>
                                </StackPanel>
                            </Border>

                            <TextBlock Text="ตัวเลือกการสร้าง (Render Options)" FontWeight="Bold" Margin="0,20,0,15" Foreground="{StaticResource TextDark}"/>

                            <Border x:Name="BorderOptAll" Background="#F3F4F6" CornerRadius="8" Padding="12" Margin="0,0,0,10" BorderThickness="1" BorderBrush="Transparent">
                                <RadioButton x:Name="RbRenderAll" GroupName="RenderOpt" IsChecked="True" Checked="RenderOption_Checked" VerticalContentAlignment="Center" Cursor="Hand">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="สร้างทั้งหมด (Render All)" FontWeight="SemiBold" Foreground="{StaticResource TextDark}"/>
                                        <TextBlock Text=" (ไม่จำกัดจำนวน)" Foreground="{StaticResource TextGray}" FontSize="12" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                    </StackPanel>
                                </RadioButton>
                            </Border>

                            <Border x:Name="BorderOptRandom" Background="White" CornerRadius="8" Padding="12" BorderThickness="1" BorderBrush="{StaticResource BorderColor}">
                                <StackPanel>
                                    <RadioButton x:Name="RbRenderRandom" GroupName="RenderOpt" Checked="RenderOption_Checked" VerticalContentAlignment="Center" Cursor="Hand">
                                        <TextBlock Text="สุ่มสร้างจำนวน (Random Select)" FontWeight="SemiBold" Foreground="{StaticResource TextDark}"/>
                                    </RadioButton>

                                    <StackPanel Margin="28,10,0,0" IsEnabled="{Binding IsChecked, ElementName=RbRenderRandom}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="จำนวน:" VerticalAlignment="Center" Foreground="{StaticResource TextGray}" Margin="0,0,10,0"/>

                                            <Border BorderBrush="{StaticResource BorderColor}" BorderThickness="1" CornerRadius="4" Background="White" Width="80">
                                                <TextBox x:Name="TxtRandomCount" Text="10" 
                             BorderThickness="0" Background="Transparent" 
                             VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Padding="0,6"
                             PreviewTextInput="NumberValidationTextBox" TextChanged="TxtRandomCount_TextChanged"/>
                                            </Border>

                                            <TextBlock Text="ไฟล์ (Videos)" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="{StaticResource TextGray}"/>
                                        </StackPanel>

                                        <TextBlock Text="* ระบบจะสุ่มจับคู่ไม่ให้ซ้ำกันตามจำนวนที่ระบุ" FontSize="11" Foreground="#9CA3AF" Margin="0,5,0,0" FontStyle="Italic"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <TextBlock x:Name="TxtRenderWarning" Text="" Foreground="#EF4444" FontSize="12" Margin="0,10,0,0" TextWrapping="Wrap" Visibility="Collapsed" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="1.5*"/>
                            <RowDefinition Height="20"/>
                            <RowDefinition Height="1*"/>
                        </Grid.RowDefinitions>

                        <Border Background="Black" CornerRadius="12" ClipToBounds="True" Effect="{DynamicResource {x:Static DropShadowEffect.ShadowDepthProperty}}">
                            <Grid>
                                <Viewbox Stretch="Uniform" VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <Grid Width="1280" Height="720" Background="Black">

                                        <MediaElement x:Name="PreviewPlayerStep4" LoadedBehavior="Manual" UnloadedBehavior="Manual" Stretch="Uniform"/>

                                        <ItemsControl x:Name="Step4OverlayItems" IsHitTestVisible="False">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <Canvas Background="Transparent"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemContainerStyle>
                                                <Style TargetType="ContentPresenter">
                                                    <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                                    <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                                                </Style>
                                            </ItemsControl.ItemContainerStyle>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{Binding DisplayBrush}" 
                                        Padding="10,5" CornerRadius="4" 
                                        BorderThickness="0">
                                                        <TextBlock Text="{Binding Text}" 
                                               FontFamily="{Binding FontFamily}"
                                               FontSize="{Binding FontSize}" 
                                               Foreground="White" 
                                               FontWeight="Normal"
                                               TextAlignment="{Binding TextAlign}"
                                               IsHitTestVisible="False"/>

                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>

                                        <StackPanel x:Name="Step4Placeholder" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False">
                                            <Path Data="{StaticResource IconPlay}" Fill="#33FFFFFF" Width="80" Height="80" Stretch="Uniform" Margin="0,0,0,20"/>
                                            <TextBlock Text="เลือกรายการเพื่อดูตัวอย่าง" Foreground="#80FFFFFF" FontSize="32" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="(Select to Preview)" Foreground="#60FFFFFF" FontSize="20" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>

                                        <Border VerticalAlignment="Bottom" HorizontalAlignment="Left" Background="#CC000000" CornerRadius="0,8,0,0" Padding="20,10" Margin="0,0,0,0">
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                    <TextBlock Text="Playing Clip: " Foreground="#AAAAAA" FontSize="14"/>
                                                    <TextBlock x:Name="TxtStep4ClipName" Text="-" Foreground="White" FontWeight="Bold" FontSize="14"/>
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="Text Effect: " Foreground="#AAAAAA" FontSize="14"/>
                                                    <TextBlock x:Name="TxtStep4EffectInfo" Text="None" Foreground="#00FF41" FontWeight="Bold" FontSize="14"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Viewbox>
                            </Grid>
                        </Border>

                        <Border Grid.Row="2" Background="White" CornerRadius="12" Padding="0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <Border BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1" Padding="15">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="รายการผลลัพธ์ (Generated Sequence)" FontWeight="Bold" Foreground="{StaticResource TextDark}"/>
                                    </StackPanel>
                                </Border>

                                <DataGrid x:Name="GridMatrix" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True" 
                      SelectionMode="Single" SelectionChanged="GridMatrix_SelectionChanged"
                      GridLinesVisibility="Horizontal" HeadersVisibility="Column" Background="Transparent" BorderThickness="0">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="#" Binding="{Binding ID}" Width="50"/>
                                        <DataGridTextColumn Header="Composition" Binding="{Binding CompositionText}" Width="*"/>
                                        <DataGridTextColumn Header="Duration" Binding="{Binding EstimatedDuration}" Width="80"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>

                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                    <Button Content="ย้อนกลับ" Width="150" Height="50" FontSize="16" Background="Transparent" Foreground="{StaticResource TextGray}" Margin="0,0,15,0" Click="PrevStep_Click"/>
                    <Button x:Name="BtnNextStep4" Content="ถัดไป (Step 5) >" Width="220" Height="50" FontSize="16" Style="{StaticResource PrimaryBtn}" Click="NextStep_Click" IsEnabled="False"/>
                </StackPanel>
            </Grid>

            <!-- STEP 5: EXPORT -->
            <Grid x:Name="ViewStep5" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="0,0,0,25">
                    <TextBlock Text="Export &amp; Render" FontSize="28" FontWeight="Bold" Foreground="{StaticResource TextDark}"/>
                    <TextBlock Text="ตรวจสอบความพร้อมและเริ่มกระบวนการสร้างไฟล์วิดีโอ" FontSize="14" Foreground="{StaticResource TextGray}" Margin="0,5,0,0"/>
                </StackPanel>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="4*"/>
                        <ColumnDefinition Width="25"/>
                        <ColumnDefinition Width="6*"/>
                    </Grid.ColumnDefinitions>

                    <Border Background="White" CornerRadius="12" Padding="30" Effect="{DynamicResource {x:Static DropShadowEffect.ShadowDepthProperty}}" VerticalAlignment="Top">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="#EEF2FF" Width="40" Height="40" CornerRadius="8">
                                    <Path Data="{StaticResource IconFolder}" Fill="{StaticResource PrimaryColor}" Height="16" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="การตั้งค่าไฟล์ (Output Settings)" FontSize="18" FontWeight="Bold" VerticalAlignment="Center" Margin="15,0,0,0" Foreground="{StaticResource TextDark}"/>
                            </StackPanel>

                            <TextBlock Text="โฟลเดอร์ปลายทาง (Output Folder)" FontWeight="SemiBold" Foreground="{StaticResource TextGray}" Margin="0,0,0,8"/>

                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Border Grid.Column="0" BorderBrush="{StaticResource BorderColor}" BorderThickness="1,1,0,1" CornerRadius="8,0,0,8" Background="#F9FAFB">
                                    <TextBox x:Name="TxtExportPath" 
                 BorderThickness="0" 
                 Background="Transparent" 
                 Padding="12" 
                 VerticalContentAlignment="Center" 
                 IsReadOnly="True"
                 Foreground="{StaticResource TextDark}" 
                 FontFamily="Consolas, Sarabun"/>
                                </Border>

                                <Button x:Name="BtnBrowsePath" Grid.Column="1" Click="BrowseExportPath_Click" 
            Width="60" Height="45" 
            Background="{StaticResource PrimaryColor}" 
            BorderThickness="0" 
            Cursor="Hand" 
            ToolTip="เลือกโฟลเดอร์ (Browse)">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="0,8,8,0">
                                                <Grid>
                                                    <Border x:Name="Hover" Background="White" Opacity="0" CornerRadius="0,8,8,0"/>

                                                    <Path Data="{StaticResource IconFolder}" Fill="White" Height="22" Stretch="Uniform" 
                              HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-2,0,0"/>
                                                </Grid>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Hover" Property="Opacity" Value="0.2"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="Hover" Property="Opacity" Value="0.4"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </Grid>
                            <TextBlock Text="ชื่อไฟล์นำหน้า (File Prefix)" FontWeight="SemiBold" Foreground="{StaticResource TextGray}" Margin="0,0,0,8"/>
                            <TextBox x:Name="TxtExportPrefix" Text="MyVideo" Padding="10" BorderBrush="{StaticResource BorderColor}" Margin="0,0,0,25"/>

                            <Separator Background="{StaticResource BorderColor}" Margin="0,0,0,25"/>

                            <TextBlock Text="ข้อมูลสรุป (Summary)" FontWeight="Bold" Margin="0,0,0,15" Foreground="{StaticResource TextDark}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="ความละเอียด (Resolution):" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <TextBlock x:Name="TxtSummaryRes" Text="Checking..." FontWeight="SemiBold" Margin="0,2,0,10"/>

                                    <TextBlock Text="ขนาดไฟล์ล่าสุด (File Size):" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <TextBlock x:Name="TxtSummarySize" Text="Waiting for Render..." FontWeight="SemiBold" Margin="0,2,0,0" Foreground="{StaticResource PrimaryColor}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="รูปแบบไฟล์ (Format):" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <TextBlock Text="MP4 (H.264)" FontWeight="SemiBold" Margin="0,2,0,10"/>

                                    <TextBlock Text="Audio:" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <TextBlock Text="AAC Stereo 192kbps" FontWeight="SemiBold" Margin="0,2,0,0"/>
                                </StackPanel>
                            </Grid>

                        </StackPanel>
                    </Border>

                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Background="White" CornerRadius="12" Padding="25" Effect="{DynamicResource {x:Static DropShadowEffect.ShadowDepthProperty}}" Margin="0,0,0,20">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                    <Border Background="#ECFDF5" Width="40" Height="40" CornerRadius="8">
                                        <Path Data="{StaticResource IconPlay}" Fill="#10B981" Height="14" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Text="สถานะการทำงาน (Status Monitor)" FontSize="18" FontWeight="Bold" VerticalAlignment="Center" Margin="15,0,0,0" Foreground="{StaticResource TextDark}"/>
                                </StackPanel>

                                <Grid Margin="0,0,0,10">
                                    <TextBlock Text="ความคืบหน้า (Progress):" FontWeight="SemiBold" Foreground="{StaticResource TextGray}"/>
                                    <TextBlock x:Name="TxtExportStatus" Text="Ready to Start" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" HorizontalAlignment="Right"/>
                                </Grid>

                                <Border CornerRadius="6" ClipToBounds="True" Height="20" Background="#F3F4F6">
                                    <ProgressBar x:Name="PbExport" Value="0" Maximum="100" BorderThickness="0" Background="Transparent" Foreground="{StaticResource PrimaryColor}"/>
                                </Border>
                            </StackPanel>
                        </Border>

                        <Border Grid.Row="1" Background="#1E1E1E" CornerRadius="12" Padding="15" BorderBrush="#333" BorderThickness="1">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="> SYSTEM LOG_ OUTPUT" FontFamily="Consolas" Foreground="#666" FontSize="11" Margin="0,0,0,10"/>

                                <TextBox x:Name="TxtExportLog" Grid.Row="1"
                             Background="Transparent" 
                             Foreground="#00FF41" 
                             FontFamily="Consolas" FontSize="12"
                             BorderThickness="0" 
                             IsReadOnly="True" 
                             TextWrapping="Wrap" 
                             VerticalScrollBarVisibility="Auto"
                             AcceptsReturn="True"
                             Text="Waiting for command..."/>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>

                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,30,0,0">
                    <Button Content="ย้อนกลับ" Width="150" Height="55" FontSize="16" Background="Transparent" Foreground="{StaticResource TextGray}" Margin="0,0,15,0" Click="PrevStep_Click" Cursor="Hand"/>

                    <Button x:Name="BtnStartExport" Click="StartExport_Click" Width="260" Height="55" FontSize="16" Background="{StaticResource PrimaryColor}" Foreground="White" FontWeight="Bold" BorderThickness="0" Cursor="Hand">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" CornerRadius="10" Effect="{DynamicResource {x:Static DropShadowEffect.ShadowDepthProperty}}">
                                    <Grid>
                                        <Border x:Name="HoverBorder" Background="White" Opacity="0" CornerRadius="10"/>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <Path Data="{StaticResource IconPlay}" Fill="White" Height="16" Stretch="Uniform" Margin="0,0,12,0"/>
                                            <TextBlock Text="เริ่ม Render (Start Export)" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="HoverBorder" Property="Opacity" Value="0.1"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Opacity" Value="0.6"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Window>